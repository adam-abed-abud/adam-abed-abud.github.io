<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://adam-abed-abud.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://adam-abed-abud.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2025-06-02T20:34:38+00:00</updated><id>https://adam-abed-abud.github.io/feed.xml</id><title type="html">blank</title><subtitle></subtitle><entry><title type="html">Monte Carlo techniques for stock price estimation</title><link href="https://adam-abed-abud.github.io/blog/2025/code/" rel="alternate" type="text/html" title="Monte Carlo techniques for stock price estimation"/><published>2025-03-30T15:09:00+00:00</published><updated>2025-03-30T15:09:00+00:00</updated><id>https://adam-abed-abud.github.io/blog/2025/code</id><content type="html" xml:base="https://adam-abed-abud.github.io/blog/2025/code/"><![CDATA[<p>This project implements a Monte Carlo Simulation for Stock Price Prediction. This post is (heavily?) inspired from <a href="https://github.com/dataman-git/codes_for_articles/blob/master/time_series_08_monte_carlo_simulation.ipynb?utm_source=ayratmurtazin.beehiiv.com&amp;utm_medium=newsletter&amp;utm_campaign=monte-carlo-simulation-for-time-series-probabilistic-forecasting&amp;_bhlid=41146da02aef82ddd8485d69776814d56e3ab6fe">GuruFinance Insighs</a> and by an old piece of code that I used for estimateing the benefits of some life insurance offers.</p> <h2 id="introduction">Introduction</h2> <p>Monte Carlo simulation is a powerful technique used in finance to model the probability of different outcomes in processes that involve random variables. In this post, I’ll walk through how to implement Monte Carlo simulations for stock price prediction using Python, using both normal distribution and Student’s t-distribution approaches.</p> <p>A personal note: I have always been fascinated by the use of Monte Carlo methods, especially in Finance. I was also always surprized by the fact that not a lot of people around me know about them, yet they are so powerful and widly used. In my university years I used to experiment a lot with such techniques. Here is a presentation I did more than 7 years ago in Italy:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mcmc1-480.webp 480w,/assets/img/projects/monte_carlo/mcmc1-800.webp 800w,/assets/img/projects/monte_carlo/mcmc1-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mcmc1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mcmc2-480.webp 480w,/assets/img/projects/monte_carlo/mcmc2-800.webp 800w,/assets/img/projects/monte_carlo/mcmc2-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mcmc2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mcmc3-480.webp 480w,/assets/img/projects/monte_carlo/mcmc3-800.webp 800w,/assets/img/projects/monte_carlo/mcmc3-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mcmc3.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>I like Monte Carlo methods because it allow us to simulate thousands of possible future price paths for a stock, helping us understand the range of potential outcomes and their probabilities. This is particularly valuable for risk management, option pricing, and portfolio optimization. I don’t have many details about such field but I believe they must apply something similar.</p> <h2 id="implementation">Implementation</h2> <p>The implementation uses several Python libraries including pandas for data manipulation, yfinance for stock data retrieval, and matplotlib for visualization. Here’s how it works:</p> <ol> <li>Download the historical gold data of 1 oz</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Download data
</span><span class="n">stock_gold</span> <span class="o">=</span> <span class="sh">"</span><span class="s">GC=F</span><span class="sh">"</span>

<span class="n">stock</span> <span class="o">=</span> <span class="n">stock_gold</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">yf</span><span class="p">.</span><span class="nf">download</span><span class="p">(</span><span class="n">stock</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="sh">"</span><span class="s">2018-01-01</span><span class="sh">"</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="sh">"</span><span class="s">2025-03-28</span><span class="sh">"</span><span class="p">)</span>

<span class="n">adj_close</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">Close</span><span class="sh">'</span><span class="p">]</span>
<span class="n">returns</span> <span class="o">=</span> <span class="n">adj_close</span><span class="p">.</span><span class="nf">pct_change</span><span class="p">()</span>

</code></pre></div></div> <p>This will yield the following:</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/price_gold-480.webp 480w,/assets/img/projects/monte_carlo/price_gold-800.webp 800w,/assets/img/projects/monte_carlo/price_gold-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/price_gold.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/percentage_change-480.webp 480w,/assets/img/projects/monte_carlo/percentage_change-800.webp 800w,/assets/img/projects/monte_carlo/percentage_change-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/percentage_change.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Price of 1oz of gold in the last 5 years. </div> <p>The last value as of March 28th is <code class="language-plaintext highlighter-rouge">3060</code> USD.</p> <h3 id="monte-carlo-mc-simulation">Monte Carlo (MC) simulation</h3> <p>Here comes the fun part. The MC simulation consists in simulating different outcomes for the price variation. We do 1000 simulations. For that we take the standard deviation of the historical data for the last 5 years (maybe not the best estimator?) and then we use it to get an estimation of the forecasted percentage change of price by taking a random number (normal distribution with the same std of the real std of the historical data).This is based on the assumption that stock returns follow a random walk.</p> <p>We therefore can estimate the simulated price for the next year.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_simulations</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">num_days</span> <span class="o">=</span> <span class="mi">365</span>
<span class="n">daily_volatility</span> <span class="o">=</span> <span class="n">returns</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>

<span class="n">simulation_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">price_series</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">rtn</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">daily_volatility</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">last_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rtn</span><span class="p">)</span>
    <span class="n">price_series</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_days</span><span class="p">):</span>
        <span class="n">rtn</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">daily_volatility</span><span class="p">)</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">price_series</span><span class="p">[</span><span class="n">days</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rtn</span><span class="p">)</span>
        <span class="n">price_series</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>

    <span class="n">simulation_df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_series</span>
</code></pre></div></div> <h3 id="results-of-the-simulation">Results of the simulation</h3> <p>Here are the results of the simulation</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mc_simulation-480.webp 480w,/assets/img/projects/monte_carlo/mc_simulation-800.webp 800w,/assets/img/projects/monte_carlo/mc_simulation-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mc_simulation.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="MC simulation" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Results of the MC simulation with 1000 trials </div> <p>It is alsom more interesting to see them as a function of the top and bottom quantiles, in other words what is the best case scenario and the worst case scenario.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mc_simulation_quantiles-480.webp 480w,/assets/img/projects/monte_carlo/mc_simulation_quantiles-800.webp 800w,/assets/img/projects/monte_carlo/mc_simulation_quantiles-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mc_simulation_quantiles.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="MC simulation quantiles" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <h3 id="monte-carlo-simulation-with-students-t-distribution">Monte Carlo Simulation with Student’s t-Distribution</h3> <p>While the normal distribution is commonly used, it often underestimates the probability of extreme events (fat tails) in financial markets. The Student’s t-distribution can better capture these tail risks. First, let’s fit a t-distribution to our historical returns:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Remove NaN values from returns
</span><span class="n">returns</span> <span class="o">=</span> <span class="n">returns</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span>

<span class="c1"># Fit t-distribution to returns
</span><span class="n">params</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">degree of freedom: </span><span class="sh">'</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">mean: </span><span class="sh">'</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">standard deviation: </span><span class="sh">'</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</code></pre></div></div> <p>I used the t-student distribution from <code class="language-plaintext highlighter-rouge">scipy.stats</code></p> <p>The following plot shows the distribution of the percentage change in price for gold (1 oz). Here is a plot that shows the actual distribution vs the t-student distribution:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/t_student-480.webp 480w,/assets/img/projects/monte_carlo/t_student-800.webp 800w,/assets/img/projects/monte_carlo/t_student-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/t_student.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="MC simulation quantiles" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>The following step is to do the MC simulation but with parameters extracted form the t-student distribtuion:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_simulations</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">num_days</span> <span class="o">=</span> <span class="mi">365</span>

<span class="n">simulation_student_t</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_simulations</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">price_series</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="n">rtn</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="nf">rvs</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
    <span class="n">price</span> <span class="o">=</span> <span class="n">last_price</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rtn</span><span class="p">)</span>
    <span class="n">price_series</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_days</span><span class="p">):</span>
        <span class="n">rtn</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="nf">rvs</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> 
        <span class="n">price</span> <span class="o">=</span> <span class="n">price_series</span><span class="p">[</span><span class="n">days</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">rtn</span><span class="p">)</span>
        <span class="n">price_series</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="n">simulation_student_t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">price_series</span>
</code></pre></div></div> <p>And here are the results:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mc_simulation_tsudent-480.webp 480w,/assets/img/projects/monte_carlo/mc_simulation_tsudent-800.webp 800w,/assets/img/projects/monte_carlo/mc_simulation_tsudent-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mc_simulation_tsudent.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="MC simulation" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <div class="caption"> Results of the MC simulation with 1000 trials using the t-student distribution </div> <p>And here are the top and bottom quantiles:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/projects/monte_carlo/mc_simulation_tsudent_quantiles-480.webp 480w,/assets/img/projects/monte_carlo/mc_simulation_tsudent_quantiles-800.webp 800w,/assets/img/projects/monte_carlo/mc_simulation_tsudent_quantiles-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/projects/monte_carlo/mc_simulation_tsudent_quantiles.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="MC simulation quantiles" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> </div> </div> <p>The key difference between these two approaches is how they handle extreme events:</p> <ul> <li> <p>Normal distribution: Assumes returns are symmetrically distributed around the mean with thin tails.</p> </li> <li> <p>Student’s t-distribution: Can better model the fat tails observed in real financial returns, capturing the higher probability of extreme events.</p> </li> </ul> <p>In practice, you’ll often notice that the t-distribution simulation shows a wider range of potential outcomes, especially in the extreme cases, which could be more realistic for risk management purposes.</p> <h2 id="conclusion">Conclusion</h2> <p>Monte Carlo simulation is a versatile technique for modeling uncertainty in financial markets. By generating thousands of possible future price paths, we can better understand the range of potential outcomes and make more informed investment decisions. I personally use it frequently (maybe too often!).</p> <p>The choice between normal and t-distribution depends on your specific needs:</p> <ul> <li>Normal distribution is simpler and works well for many applications</li> <li>T-distribution better captures extreme events and is often more appropriate for risk management</li> </ul> <p>This approach can be extended to multiple assets, different time horizons, and more complex financial instruments like options and structured products.</p> <p>The full code for this example can be found in this github repository with the python notebook (<a href="assets/img/projects/monte_carlo/monte_carlo.ipynb">here</a>).</p>]]></content><author><name></name></author><summary type="html"><![CDATA[Analyzing stock values using MC techniques]]></summary></entry></feed>