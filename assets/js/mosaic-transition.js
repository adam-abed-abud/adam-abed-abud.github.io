class MosaicTransition{constructor(){this.overlay=null,this.tiles=[],this.isTransitioning=!1,this.init()}init(){parseInt(getComputedStyle(document.documentElement).getPropertyValue("--mosaic-enabled"))&&(window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(this.ROWS=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--mosaic-rows")),this.COLS=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--mosaic-cols")),this.DURATION=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--mosaic-duration")),this.COVER_PERCENTAGE=parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--mosaic-cover-percentage")),this.createOverlay(),this.buildGrid(),this.interceptNavigation(),this.setupCleanup()))}createOverlay(){this.overlay=document.createElement("div"),this.overlay.id="mosaic-transition",this.overlay.className="mosaic-transition",this.overlay.setAttribute("aria-hidden","true"),document.body.appendChild(this.overlay)}buildGrid(){this.overlay.innerHTML="",this.tiles=[];for(let t=0;t<this.ROWS;t++)for(let t=0;t<this.COLS;t++){const t=document.createElement("div");t.className="mosaic-tile",this.tiles.push(t),this.overlay.appendChild(t)}}chooseActiveTiles(){const t=.8*this.DURATION;this.tiles.forEach(e=>{e.classList.remove("active"),e.style.transitionDelay=Math.round(Math.random()*t)+"ms"});const e=Math.max(1,Math.round(this.COVER_PERCENTAGE*this.tiles.length)),i=[...this.tiles.keys()];for(let t=i.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}for(let t=0;t<e;t++)this.tiles[i[t]].classList.add("active");return e}async performTransition(t){if(this.isTransitioning)return;this.isTransitioning=!0,this.chooseActiveTiles(),this.overlay.classList.remove("revealing"),this.overlay.classList.add("covering");const e=this.tiles.filter(t=>t.classList.contains("active")),i=e.length?Math.max(...e.map(t=>parseFloat(t.style.transitionDelay))):0;await new Promise(t=>setTimeout(t,this.DURATION+i+30)),window.location.href=t}async performReveal(){this.chooseActiveTiles(),this.overlay.classList.remove("covering"),this.overlay.classList.add("revealing");const t=this.tiles.filter(t=>t.classList.contains("active")),e=t.length?Math.max(...t.map(t=>parseFloat(t.style.transitionDelay))):0;await new Promise(t=>setTimeout(t,this.DURATION+e+30)),this.overlay.classList.remove("revealing"),this.isTransitioning=!1}forceCleanup(){this.overlay&&(this.overlay.classList.remove("covering","revealing"),this.overlay.classList.add("force-cleanup"),this.isTransitioning=!1,this.tiles.forEach(t=>{t.classList.remove("active"),t.style.transitionDelay=""}),setTimeout(()=>{this.overlay&&this.overlay.classList.remove("force-cleanup")},150))}setupCleanup(){window.addEventListener("beforeunload",()=>{this.forceCleanup()}),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.forceCleanup()}),window.addEventListener("focus",()=>{setTimeout(()=>{!this.isTransitioning&&this.overlay.classList.contains("covering")&&this.forceCleanup()},100)})}updateTheme(){const t="dark"===document.documentElement.getAttribute("data-theme")||document.documentElement.classList.contains("dark"),e=getComputedStyle(document.documentElement).getPropertyValue("--mosaic-cover-color").trim();["#4a5df8","#4a5df8","#4a5df8"].includes(e)&&(t?document.documentElement.style.setProperty("--mosaic-cover-color","#4a5df7"):document.documentElement.style.setProperty("--mosaic-cover-color","#4a5df8"))}interceptNavigation(){document.addEventListener("click",t=>{const e=t.target.closest("a");if(!e)return;const i=e.getAttribute("href");i&&(i.startsWith("http")||i.startsWith("mailto:")||i.startsWith("tel:")||i.startsWith("#")||"_blank"===e.target||e.hasAttribute("download")||e.getAttribute("data-toggle")||"search-toggle"===e.id||"light-toggle"===e.id||e.classList.contains("dropdown-toggle")||e.hasAttribute("data-bs-toggle")||e.closest("form")||e.getAttribute("onclick")||e.classList.contains("figure-link")||e.hasAttribute("data-zoomable-image")||(t.preventDefault(),this.performTransition(i)))}),window.addEventListener("popstate",()=>{this.forceCleanup(),setTimeout(()=>{this.isTransitioning||this.performReveal()},50)})}}document.addEventListener("DOMContentLoaded",()=>{window.mosaicTransition=new MosaicTransition,window.mosaicTransition.updateTheme(),new MutationObserver(()=>{window.mosaicTransition.updateTheme()}).observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme","class"]}),document.referrer&&document.referrer.includes(window.location.hostname)?setTimeout(()=>{window.mosaicTransition.performReveal()},100):setTimeout(()=>{window.mosaicTransition.forceCleanup()},100)}),window.addEventListener("load",()=>{window.mosaicTransition&&window.mosaicTransition.overlay&&window.mosaicTransition.overlay.classList.contains("covering")&&!window.mosaicTransition.isTransitioning&&window.mosaicTransition.forceCleanup()}),window.addEventListener("pageshow",t=>{t.persisted&&window.mosaicTransition&&setTimeout(()=>{window.mosaicTransition.forceCleanup()},50)}),setTimeout(()=>{if(window.mosaicTransition&&window.mosaicTransition.overlay){window.mosaicTransition.overlay.classList.contains("covering")&&!window.mosaicTransition.isTransitioning&&window.mosaicTransition.forceCleanup()}},2e3);