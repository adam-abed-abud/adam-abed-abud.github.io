!function t(e,i,n){function r(h,a){if(!i[h]){if(!e[h]){var o="function"==typeof require&&require;if(!a&&o)return o(h,!0);if(s)return s(h,!0);var c=new Error("Cannot find module '"+h+"'");throw c.code="MODULE_NOT_FOUND",c}var f=i[h]={exports:{}};e[h][0].call(f.exports,function(t){var i=e[h][1][t];return r(i||t)},f,f.exports,t,e,i,n)}return i[h].exports}for(var s="function"==typeof require&&require,h=0;h<n.length;h++)r(n[h]);return r}({1:[function(t,e){t("./utils.js");var i=t("./consts.js"),n=i.GRID_LINE_COLOR,r=i.BOX_BORDER_COLOR,s=function(t,e,i,n){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineWidth=1,t.strokeStyle=n,t.stroke(),t.closePath()},h=function(t,e,i,r,h,a){var o=t.getContext("2d"),c=t.width,f=t.height;o.rect(0,0,c,f);var u=o.createLinearGradient(0,0,0,f);u.addColorStop(0,h),u.addColorStop(1,a),o.fillStyle=u,o.fill();for(var l=1;l<i;l++){var v=e*l+.5;s(o,{x:v,y:0},{x:v,y:f},n)}for(l=1;l<r;l++){var d=e*l+.5;s(o,{x:0,y:d},{x:c,y:d},n)}},a=function(t,e,i,n,s){n<0||(t.beginPath(),t.rect(i,n,s,s),t.fillStyle=e,t.fill(),t.strokeStyle=r,t.lineWidth=1,t.stroke(),t.closePath())},o={init:function(t,e){this.scene=t,this.preview=e,this.sceneContext=t.getContext("2d"),this.previewContext=e.getContext("2d"),this.gridSize=t.width/i.COLUMN_COUNT,this.previewGridSize=e.width/i.PREVIEW_COUNT,this.drawScene()},clearScene:function(){this.sceneContext.clearRect(0,0,this.scene.width,this.scene.height)},clearPreview:function(){this.previewContext.clearRect(0,0,this.preview.width,this.preview.height)},drawScene:function(){this.clearScene(),h(this.scene,this.gridSize,i.COLUMN_COUNT,i.ROW_COUNT,i.SCENE_BG_START,i.SCENE_BG_END)},drawMatrix:function(t){for(var e=0;e<t.length;e++)for(var i=t[e],n=0;n<i.length;n++)0!==i[n]&&a(this.sceneContext,i[n],n*this.gridSize,e*this.gridSize,this.gridSize)},drawPreview:function(){h(this.preview,this.previewGridSize,i.PREVIEW_COUNT,i.PREVIEW_COUNT,i.PREVIEW_BG,i.PREVIEW_BG)},drawShape:function(t){if(t)for(var e=t.matrix(),i=this.gridSize,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++){if(1===e[n][r]){var s=i*(t.x+r),h=i*(t.y+n);a(this.sceneContext,t.color,s,h,i)}}},drawPreviewShape:function(t){if(t){this.clearPreview();for(var e=t.matrix(),i=this.previewGridSize,n=(this.preview.width-i*t.getColumnCount())/2,r=(this.preview.height-i*t.getRowCount())/2,s=0;s<e.length;s++)for(var h=0;h<e[s].length;h++){if(1===e[s][h]){var o=n+i*h,c=r+i*s;a(this.previewContext,t.color,o,c,i)}}}}};e.exports=o},{"./consts.js":2,"./utils.js":5}],2:[function(t,e,i){var n=["#00af9d","#ffb652","#cd66cc","#66bc29","#0096db","#3a7dda","#ffe100"],r=120,s=10,h=20,a=6,o="#8e9ba6",c="#5c6975",f="#2f2f2f",u="rgba(255,255,255,0.2)",l="rgba(255,255,255,0.5)",v=600,d=12e4;(i=e.exports={}).COLORS=n,i.SIDE_WIDTH=r,i.ROW_COUNT=h,i.COLUMN_COUNT=s,i.SCENE_BG_START=o,i.SCENE_BG_END=c,i.PREVIEW_BG=f,i.PREVIEW_COUNT=a,i.GRID_LINE_COLOR=u,i.BOX_BORDER_COLOR=l,i.DEFAULT_INTERVAL=v,i.LEVEL_INTERVAL=d},{}],3:[function(t){function e(t){this.id=t,this.init()}var i=t("./utils.js"),n=t("./consts.js"),r=t("./shapes.js"),s=t("./views.js"),h=t("./canvas.js"),a=function(t,e){for(var i=[],n=0;n<t;n++){var r=[];i.push(r);for(var s=0;s<e;s++)r.push(0)}return i},o=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].length;i++)t[e][i]=0},c=function(t){for(var e=[],i=0;i<t.length;i++){for(var n=t[i],r=!0,s=0;s<n.length;s++)r=r&&0!==n[s];r&&e.push(i)}return e},f=function(t,e){for(var i=t[0].length,n=e;n>=0;n--)for(var r=0;r<i;r++)t[n][r]=n>0?t[n-1][r]:0},u=function(t,e){for(var i in e)f(t,e[i])},l=function(t){for(var e=t[0],i=0;i<e.length;i++)if(0!==e[i])return!0;return!1},v=function(t){return t&&t.length>1?100*Math.pow(2,t.length-1):0},d=function(t){return t&&t.length?100*t.length:0},w=function(t){return n.DEFAULT_INTERVAL-60*(t-1)},p={maxHeight:700,maxWidth:600};e.prototype={init:function(t){var e=this.config=i.extend(t,p);this.interval=n.DEFAULT_INTERVAL,s.init(this.id,e.maxWidth,e.maxHeight),h.init(s.scene,s.preview),this.matrix=a(n.ROW_COUNT,n.COLUMN_COUNT),this.reset(),this._initEvents(),this._fireShape()},reset:function(){this.running=!1,this.isGameOver=!1,this.level=1,this.score=0,this.startTime=(new Date).getTime(),this.currentTime=this.startTime,this.prevTime=this.startTime,this.levelTime=this.startTime,o(this.matrix),s.setLevel(this.level),s.setScore(this.score),s.setGameOver(this.isGameOver),this._draw()},start:function(){this.running=!0,window.requestAnimationFrame(i.proxy(this._refresh,this))},pause:function(){this.running=!1,this.currentTime=(new Date).getTime(),this.prevTime=this.currentTime},gamveOver:function(){},_keydownHandler:function(t){var e=this.matrix;if(!t)t=window.event;if(!this.isGameOver&&this.shape)switch(t.keyCode){case 37:this.shape.goLeft(e),this._draw();break;case 39:this.shape.goRight(e),this._draw();break;case 38:this.shape.rotate(e),this._draw();break;case 40:this.shape.goDown(e),this._draw();break;case 32:this.shape.goBottom(e),this._update()}},_restartHandler:function(){this.reset(),this.start()},_initEvents:function(){window.addEventListener("keydown",i.proxy(this._keydownHandler,this),!1),s.btnRestart.addEventListener("click",i.proxy(this._restartHandler,this),!1)},_fireShape:function(){this.shape=this.preparedShape||r.randomShape(),this.preparedShape=r.randomShape(),this._draw(),h.drawPreviewShape(this.preparedShape)},_draw:function(){h.drawScene(),h.drawShape(this.shape),h.drawMatrix(this.matrix)},_refresh:function(){this.running&&(this.currentTime=(new Date).getTime(),this.currentTime-this.prevTime>this.interval&&(this._update(),this.prevTime=this.currentTime,this._checkLevel()),this.isGameOver||window.requestAnimationFrame(i.proxy(this._refresh,this)))},_update:function(){this.shape.canDown(this.matrix)?this.shape.goDown(this.matrix):(this.shape.copyTo(this.matrix),this._check(),this._fireShape()),this._draw(),this.isGameOver=l(this.matrix),s.setGameOver(this.isGameOver),this.isGameOver&&s.setFinalScore(this.score)},_check:function(){var t=c(this.matrix);if(t.length){u(this.matrix,t);var e=d(t),i=v(t);this.score+=e+i,s.setScore(this.score),s.setReward(i)}},_checkLevel:function(){var t=(new Date).getTime();t-this.levelTime>n.LEVEL_INTERVAL&&(this.level+=1,this.interval=w(this.level),s.setLevel(this.level),this.levelTime=t)}},window.Tetris=e},{"./canvas.js":1,"./consts.js":2,"./shapes.js":4,"./utils.js":5,"./views.js":6}],4:[function(t,e){function i(){var t=[[1,0],[1,0],[1,1]],e=[[0,0,1],[1,1,1]],i=[[1,1],[0,1],[0,1]],n=[[1,1,1],[1,0,0]];this.states=[t,e,i,n],this.x=4,this.y=-3,this.flag="L"}function n(){var t=[[0,1],[0,1],[1,1]],e=[[1,1,1],[0,0,1]],i=[[1,1],[1,0],[1,0]],n=[[1,0,0],[1,1,1]];this.states=[t,e,i,n],this.x=4,this.y=-3,this.flag="LR"}function r(){var t=[[1,1],[1,1]];this.states=[t],this.x=4,this.y=-2,this.flag="O"}function s(){var t=[[1],[1],[1],[1]],e=[[1,1,1,1]];this.states=[t,e],this.x=5,this.y=-4,this.flag="I"}function h(){var t=[[1,1,1],[0,1,0]],e=[[1,0],[1,1],[1,0]],i=[[0,1,0],[1,1,1]],n=[[0,1],[1,1],[0,1]];this.states=[t,e,i,n],this.x=4,this.y=-2,this.flag="T"}function a(){var t=[[1,1,0],[0,1,1]],e=[[0,1],[1,1],[1,0]];this.states=[t,e],this.x=4,this.y=-2,this.flag="Z"}function o(){var t=[[0,1,1],[1,1,0]],e=[[1,0],[1,1],[0,1]];this.states=[t,e],this.x=4,this.y=-2,this.flag="ZR"}function c(){var t;switch(Math.floor(7*Math.random())){case 0:t=new i;break;case 1:t=new r;break;case 2:t=new a;break;case 3:t=new h;break;case 4:t=new n;break;case 5:t=new o;break;case 6:t=new s}return t.init(),t}var f=t("./consts.js"),u=f.COLORS,l=f.COLUMN_COUNT,v=function(t,e,i){var n=e.length,r=e[0].length,s=function(s){var h=t.x+s.x,a=t.y+s.y;return a<0||("left"===i?(h-=1)>=0&&h<r&&0==e[a][h]:"right"===i?(h+=1)>=0&&h<r&&0==e[a][h]:"down"===i?(a+=1)<n&&0==e[a][h]:"rotate"===i?a<n&&!e[a][h]:void 0)},h="rotate"===i?t.getBoxes(t.nextState()):t.getBoxes(t.state);for(var a in h)if(!s(h[a]))return!1;return!0};i.prototype=n.prototype=r.prototype=s.prototype=h.prototype=a.prototype=o.prototype={init:function(){this.color=u[Math.floor(7*Math.random())],this.state=0,this.allBoxes={},this.y=0},getBoxes:function(t){var e=this.allBoxes[t]||[];if(e.length)return e;for(var i=this.matrix(t),n=0;n<i.length;n++)for(var r=i[n],s=0;s<r.length;s++)1===r[s]&&e.push({x:s,y:n});return this.allBoxes[t]=e,e},matrix:function(t){var e=t!==undefined?t:this.state;return this.states[e]},rotate:function(t){if(v(this,t,"rotate")){this.state=this.nextState();var e=this.getRight();e>=l&&(this.x-=e-l+1)}},getColumnCount:function(){for(var t=this.matrix(),e=0,i=0;i<t.length;i++)e=Math.max(e,t[i].length);return e},getRowCount:function(){return this.matrix().length},getRight:function(){var t=this.getBoxes(this.state),e=0;for(var i in t)e=Math.max(t[i].x,e);return this.x+e},nextState:function(){return(this.state+1)%this.states.length},canDown:function(t){return v(this,t,"down")},goDown:function(t){v(this,t,"down")&&(this.y+=1)},goBottom:function(t){for(;v(this,t,"down");)this.y+=1},goLeft:function(t){v(this,t,"left")&&(this.x-=1)},goRight:function(t){v(this,t,"right")&&(this.x+=1)},copyTo:function(t){for(var e=this.matrix(),i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(1===n[r]){var s=this.x+r,h=this.y+i;s>=0&&s<t[0].length&&h>=0&&h<t.length&&(t[h][s]=this.color)}}},e.exports.randomShape=c},{"./consts.js":2}],5:[function(t,e,i){i=e.exports={};var n=function(t){return document.getElementById(t)},r=function(t){return"object"==typeof t&&!(t.constructor&&!hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))},s=function(){var t,e,i,n,h,a,o=arguments[0]||{},c=1,f=arguments.length,u=!0;for("boolean"==typeof o&&(u=o,o=arguments[c]||{},c++),"object"!=typeof o&&"function"!=typeof obj&&(o={}),c===f&&(o=this,c--);c<f;c++)if(null!=(h=arguments[c]))for(n in h)t=o[n],o!==(i=h[n])&&(u&&i&&(r(i)||(e=Array.isArray(i)))?(e?(e=!1,a=t&&Array.isArray(t)?t:[]):a=t&&r(t)?t:{},o[n]=s(u,a,i)):i!==undefined&&(o[n]=i));return o},h=function(t,e){var i=[].slice.call(arguments,2);return h=function(){return t.apply(e||this,i.concat([].slice.call(arguments)))}},a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=a,i.$=n,i.extend=s,i.proxy=h},{}],6:[function(t,e){var i=t("./utils.js"),n=t("./consts.js"),r=i.$,s=r("scene"),h=r("side"),a=r("info"),o=r("preview"),c=r("level"),f=r("score"),u=r("rewardInfo"),l=r("reward"),v=r("gameOver"),d=r("restart"),w=r("finalScore"),p=n.SIDE_WIDTH,g=function(t,e){var i=document.documentElement.clientWidth,n=document.documentElement.clientHeight,r={};return i>n?(r.height=Math.min(e,n),r.width=Math.min(r.height/2+p,t)):(r.width=Math.min(t,i),r.height=Math.min(e,n)),r},m=function(t,e,i){var n=g(e,i),r=t.style;r.height=n.height+"px",r.width=n.width+"px",r.marginTop=-n.height/2+"px",r.marginLeft=-n.width/2+"px",s.height=n.height,s.width=s.height/2;var c=n.width-s.width;h.style.width=c+"px",c<p&&(a.style.width=h.style.width),o.width=80,o.height=80,v.style.width=s.width+"px"},x={init:function(t,e,i){this.container=r(t),this.scene=s,this.preview=o,this.btnRestart=d,m(this.container,e,i),this.scene.focus(),u.addEventListener("animationEnd",function(){u.className="invisible"})},setScore:function(t){f.innerHTML=t},setFinalScore:function(t){w.innerHTML=t},setLevel:function(t){c.innerHTML=t},setReward:function(t){t>0?(l.innerHTML=t,u.className="fadeOutUp animated"):u.className="invisible"},setGameOver:function(t){v.style.display=t?"block":"none"}};e.exports=x},{"./consts.js":2,"./utils.js":5}]},{},[3]);