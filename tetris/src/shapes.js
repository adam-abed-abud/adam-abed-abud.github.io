function ShapeL(){var t=[[1,0],[1,0],[1,1]],e=[[0,0,1],[1,1,1]],a=[[1,1],[0,1],[0,1]],h=[[1,1,1],[1,0,0]];this.states=[t,e,a,h],this.x=4,this.y=-3,this.flag="L"}function ShapeLR(){var t=[[0,1],[0,1],[1,1]],e=[[1,1,1],[0,0,1]],a=[[1,1],[1,0],[1,0]],h=[[1,0,0],[1,1,1]];this.states=[t,e,a,h],this.x=4,this.y=-3,this.flag="LR"}function ShapeO(){var t=[[1,1],[1,1]];this.states=[t],this.x=4,this.y=-2,this.flag="O"}function ShapeI(){var t=[[1],[1],[1],[1]],e=[[1,1,1,1]];this.states=[t,e],this.x=5,this.y=-4,this.flag="I"}function ShapeT(){var t=[[1,1,1],[0,1,0]],e=[[1,0],[1,1],[1,0]],a=[[0,1,0],[1,1,1]],h=[[0,1],[1,1],[0,1]];this.states=[t,e,a,h],this.x=4,this.y=-2,this.flag="T"}function ShapeZ(){var t=[[1,1,0],[0,1,1]],e=[[0,1],[1,1],[1,0]];this.states=[t,e],this.x=4,this.y=-2,this.flag="Z"}function ShapeZR(){var t=[[0,1,1],[1,1,0]],e=[[1,0],[1,1],[0,1]];this.states=[t,e],this.x=4,this.y=-2,this.flag="ZR"}function randomShape(){var t;switch(Math.floor(7*Math.random())){case 0:t=new ShapeL;break;case 1:t=new ShapeO;break;case 2:t=new ShapeZ;break;case 3:t=new ShapeT;break;case 4:t=new ShapeLR;break;case 5:t=new ShapeZR;break;case 6:t=new ShapeI}return t.init(),t}var consts=require("./consts.js"),COLORS=consts.COLORS,COLUMN_COUNT=consts.COLUMN_COUNT,isShapeCanMove=function(t,e,a){var h=e.length,s=e[0].length,i=function(i){var n=t.x+i.x,o=t.y+i.y;return o<0||("left"===a?(n-=1)>=0&&n<s&&0==e[o][n]:"right"===a?(n+=1)>=0&&n<s&&0==e[o][n]:"down"===a?(o+=1)<h&&0==e[o][n]:"rotate"===a?o<h&&!e[o][n]:void 0)},n="rotate"===a?t.getBoxes(t.nextState()):t.getBoxes(t.state);for(var o in n)if(!i(n[o]))return!1;return!0};ShapeL.prototype=ShapeLR.prototype=ShapeO.prototype=ShapeI.prototype=ShapeT.prototype=ShapeZ.prototype=ShapeZR.prototype={init:function(){this.color=COLORS[Math.floor(7*Math.random())],this.state=0,this.allBoxes={},this.y=0},getBoxes:function(t){var e=this.allBoxes[t]||[];if(e.length)return e;for(var a=this.matrix(t),h=0;h<a.length;h++)for(var s=a[h],i=0;i<s.length;i++)1===s[i]&&e.push({x:i,y:h});return this.allBoxes[t]=e,e},matrix:function(t){var e=t!==undefined?t:this.state;return this.states[e]},rotate:function(t){if(isShapeCanMove(this,t,"rotate")){this.state=this.nextState();var e=this.getRight();e>=COLUMN_COUNT&&(this.x-=e-COLUMN_COUNT+1)}},getColumnCount:function(){for(var t=this.matrix(),e=0,a=0;a<t.length;a++)e=Math.max(e,t[a].length);return e},getRowCount:function(){return this.matrix().length},getRight:function(){var t=this.getBoxes(this.state),e=0;for(var a in t)e=Math.max(t[a].x,e);return this.x+e},nextState:function(){return(this.state+1)%this.states.length},canDown:function(t){return isShapeCanMove(this,t,"down")},goDown:function(t){isShapeCanMove(this,t,"down")&&(this.y+=1)},goBottom:function(t){for(;isShapeCanMove(this,t,"down");)this.y+=1},goLeft:function(t){isShapeCanMove(this,t,"left")&&(this.x-=1)},goRight:function(t){isShapeCanMove(this,t,"right")&&(this.x+=1)},copyTo:function(t){for(var e=this.matrix(),a=0;a<e.length;a++)for(var h=e[a],s=0;s<h.length;s++)if(1===h[s]){var i=this.x+s,n=this.y+a;i>=0&&i<t[0].length&&n>=0&&n<t.length&&(t[n][i]=this.color)}}},module.exports.randomShape=randomShape;